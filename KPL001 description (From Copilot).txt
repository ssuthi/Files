The SQL scriptÂ Bond_FIFO_EffYield_ViewV.original.sqlÂ defines aÂ stored procedureÂ namedÂ Bond_FIFO_EffYield_ViewVÂ used forÂ calculating effective yield and P&L (Profit and Loss)Â forÂ bond and paper instrumentsÂ using theÂ FIFO (First-In-First-Out)Â inventory method andÂ constant yield amortization.

ğŸ”Â Purpose
To generate a detailed report of bond and paper transactions, including:
Realized and unrealized P&L
Accrued interest
Amortized amounts
Effective yields
Position tracking over time

ğŸ§®Â Key Features & Logic
1.Â Input Parameters
The procedure accepts multiple parameters to filter and control the calculation:
Portfolio, folder, branch, group IDs
Evaluation date range
Price source (HÂ for historical,Â RÂ for real-time)
Accrued convention (FÂ for first,Â LÂ for last)
Amortization type (VÂ for value date,Â TÂ for trade date)
Deal type (BÂ for bonds,Â PÂ for papers,Â AÂ for all)
Flags for storing values and including certain P&L components
2.Â Data Preparation
Selects relevant folders and deals based on hierarchy and filters.
Retrieves market data (price, accrued interest) from historical or real-time sources.
Calculates conversion rates and adjusts prices for yield-based quotations.
3.Â FIFO Matching
Implements FIFO logic to match buy and sell transactions.
Calculates realized P&L, accrued interest, and amortized amounts for each matched pair.
Handles unmatched positions and computes their unrealized values.
4.Â Amortization & Yield Calculation
Uses a constant yield method to compute amortization.
Converts between price and yield using helper procedures.
Updates yields for positions and off-balance sheet items.
5.Â Reporting Tables
Creates and populates several temporary and permanent tables:
#Position,Â #FromStartPnL,Â #OffBalancePL,Â #FoldersPL,Â #AllPL
Final results are stored inÂ FIFOReportViewÂ and other output tables (mbINT_FIFOReport_OUP1, etc.)
6.Â Storage & Cleanup
Optionally stores computed values in permanent tables (FromStartFIFOPLV,Â PositionV, etc.)
Cleans up old data based on evaluation date and retention logic.

ğŸ“ŠÂ Outputs
The procedure produces:
Detailed deal-level P&LÂ (realized, accrued, amortized)
Folder-level and overall summaries
Effective yield calculations
Off-balance sheet positions
Historical tracking for audit and reporting

ğŸ§ Â Business Context
This procedure is likely used inÂ financial institutionsÂ for:
Risk and performance reporting
Regulatory compliance
Accounting and audit trails
Valuation and pricing of fixed-income instruments

Here is theÂ data flow diagramÂ for theÂ Bond_FIFO_EffYield_ViewVÂ procedure, illustrating how data moves through the system during the bond FIFO effective yield and P&L calculation:
!Bond FIFO Data Flow Diagram

